### Проект для тестирования с системой меню и управлением с помощью энкодера

- **Микроконтроллер:** ATmega328P 
- **Fuse bits:** LOW 0xCE, HIGH 0xD2
- **IDE:** Microchip Studio (Atmel Studio) 7
- **Язык:** C (Embedded)
- **Дисплей:** LCD ST7735 0.96" 80_160(IPS) или 1.8" 128_160(STN)
- **Датчики:** BME280, MPU6050
- **Управление:** Энкодер + кнопка
- **Программатор:** USBasp

### Больше по дисплею
- можно любой на ST7735, но в дефайнах изменить разрешение, а также параметры LCD_HEIGHT_OFFSET и LCD_WIDTH_OFFSET выставить на 0, либо подобрать свои смещения
- возможно придется поиграться с регистрами MADCTL и INVON/INVOFF дисплея для установки верной ориентации и режима отображения цветов

### Клонирование репозитория
git clone https://github.com/paschendale1917/avr_test.git

### Сделано:
- организована обработка энкодера и кнопки на канале А таймера0
- организован ШИМ на таймере1(управление подсветкой дисплея)
- реализована автоматическая запись настроек подсветки во встроенную eeprom(требуется установить FUSE бит EESAVE,чтобы eeprom не терлась при стирании памяти контроллера во время прошивки)
- реализован опрос любого свободного входа АЦП, используя прерывания канала А таймера0
- реализованы прием и передача данных по интерфейсам uart, spi, i2c
- написана примитивная библиотека c поддержкой дисплеев двух разрешений(настраивается в дефайнах)
- написана заготовка для меню
- организована навигация по меню
- прием и обработка сырых данных BME280(получение температуры, давления, влажности)
- прием сырых данных с mpu6050(требуется доработка)
- добавлен скринсейвер с отображением лого МФТИ
 
### Управление:
- вход в меню из скринсейвера по длительному нажатию на энкодер
- выход из меню на скрисейвер по длительному нажатию на энкодер
- вход в меню более глубокой вложенности(child) по короткому нажатию на кнопку энкодера
- вход в меню более низкой вложенности(parent) по длительному нажатию на кнопку энкодера
- вход в обработчик пункта меню по короткому нажатию на кнопку энкодера
- выход из обработчика пункта меню по длительному нажатию на кнопку энкодера

 
### Внимание!
- Требуется установить галочки и добавить библиотеку как показано на приложенных скриншотах, иначе sprintf не будет корректно работать с float
- При прошивке возможны проблемы, если не отключить дисплей от питания(мега шьется через spi, на котором "сидит" дисплей)

### TO DO:
- Меню
- MPU6050 
- разобраться с собакой
- разобраться с режимами низкого энергопотребления
